<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- PWA: Matches status bar to background on iPhone -->
    <meta name="theme-color" content="#14181c">
    <title>The Reiner Run</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --lb-bg: #14181c;
            --lb-card: #2c3440;
            --lb-text: #99aabb;
            --lb-white: #ffffff;
            --lb-green: #00e054;
            --lb-orange: #ff8000;
            --lb-blue: #40bcf4;
            --lb-grey: #455565;
            --lb-track: #1f252d;
            --lb-hover: #36404d;
        }

        body {
            background-color: var(--lb-bg);
            color: var(--lb-text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .font-serif-lb {
            font-family: 'Merriweather', serif;
        }

        .lb-card {
            background-color: var(--lb-card);
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Custom Checkbox */
        .lb-checkbox {
            appearance: none;
            background-color: var(--lb-track);
            border: 1px solid #455565;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            /* Circle like Letterboxd 'eye' icon roughly, or simple toggle */
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: grid;
            place-items: center;
        }

        .lb-checkbox:checked {
            background-color: var(--lb-green);
            border-color: var(--lb-green);
        }

        .lb-checkbox:checked::after {
            content: "✓";
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        /* Row Hover */
        .movie-row {
            transition: background-color 0.2s;
        }

        .movie-row:hover {
            background-color: rgba(255, 255, 255, 0.02);
        }

        /* Poster Placeholder */
        .poster {
            aspect-ratio: 2/3;
            background-color: #1f252d;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Back Button CSS matches betterloxd */
        .back-btn:hover svg {
            transform: translateX(-2px);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-start p-4 pb-20 relative">

    <!-- Back Button -->
    <a href="index.html"
        class="absolute top-6 left-6 flex items-center gap-2 text-[#677589] hover:text-white transition-colors back-btn group no-underline z-10">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="transition-transform">
            <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        <span
            class="text-xs uppercase tracking-widest font-bold hidden sm:inline-block group-hover:text-white">Index</span>
    </a>

    <div class="w-full max-w-2xl mt-16 space-y-8">

        <!-- Header -->
        <div class="text-center space-y-2">
            <h1 class="text-3xl text-white font-serif-lb font-bold tracking-tight">The Reiner Run</h1>
            <p class="text-xs uppercase tracking-widest font-semibold text-[#556677]">I'll have what she's having.</p>
        </div>

        <!-- Progress Section -->
        <div class="lb-card p-6">
            <div class="flex justify-between items-end mb-2">
                <span class="text-xs uppercase tracking-wider font-bold text-[#677589]">Progress</span>
                <span id="progressText" class="text-2xl font-serif-lb text-white font-bold">0%</span>
            </div>
            <div class="w-full bg-[#14181c] h-4 rounded-full overflow-hidden border border-white/5">
                <div id="progressBar" class="h-full bg-green-500 transition-all duration-500 ease-out"
                    style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-xs text-[#556677] mt-2">
                <span id="watchedCount">0 watched</span>
                <span id="totalCount">0 total</span>
            </div>
        </div>

        <!-- Movie List -->
        <div id="movieList" class="space-y-1">
            <!-- Movies injected here -->
        </div>

    </div>

    <!-- Hidden Template -->
    <template id="movieRowTemplate">
        <div class="movie-row lb-card p-4 flex items-center gap-4 transition-all hover:bg-[#303846]">
            <!-- Checkbox -->
            <div class="flex-shrink-0">
                <input type="checkbox" class="lb-checkbox movie-check">
            </div>

            <!-- Poster -->
            <div
                class="flex-shrink-0 w-12 h-[72px] bg-[#1f252d] border border-white/10 rounded-sm overflow-hidden relative shadow-md">
                <img class="w-full h-full object-cover poster-img hidden" alt="Poster">
                <div
                    class="poster-placeholder w-full h-full flex items-center justify-center text-[#455565] text-xs font-bold font-serif-lb absolute top-0 left-0">
                    <span class="poster-year"></span>
                </div>
            </div>

            <!-- Info -->
            <div class="flex-grow min-w-0">
                <div class="flex items-baseline gap-2 flex-wrap">
                    <h3 class="text-white font-bold text-lg font-serif-lb leading-tight truncate movie-title">Movie
                        Title</h3>
                    <span class="text-[#556677] text-sm movie-year">Year</span>
                </div>

                <!-- Where to watch / Witty Remark -->
                <div class="mt-2 text-xs">
                    <span class="text-[#40bcf4] font-bold uppercase tracking-wider streaming-info hidden"></span>
                    <span class="text-[#677589] italic font-serif-lb witty-remark hidden"></span>
                </div>

                <!-- Fallback Link -->
                <div class="mt-1">
                    <a href="#" target="_blank"
                        class="text-[10px] uppercase tracking-wider text-[#556677] hover:text-white transition-colors no-underline where-to-watch-link">
                        Search <span class="align-top">↗</span>
                    </a>
                </div>
            </div>
        </div>
    </template>

    <script>
        const films = [
            {
                title: "This Is Spinal Tap",
                year: 1984,
                poster: "https://m.media-amazon.com/images/M/MV5BMTQ2MTIzMzg5Nl5BMl5BanBnXkFtZTgwOTc5NDI1MDE@._V1_SX300.jpg",
                streaming: "Rent/Buy"
            },
            {
                title: "The Sure Thing",
                year: 1985,
                poster: "https://m.media-amazon.com/images/M/MV5BMTg4MjQ1NjgxN15BMl5BanBnXkFtZTcwMzYyMTcyMQ@@._V1_SX300.jpg",
                streaming: ""
            },
            {
                title: "Stand by Me",
                year: 1986,
                poster: "https://m.media-amazon.com/images/M/MV5BODJmY2Y2OGQtMDg2My00N2Q3LWJmZTUtYTc2ODBjZDVlNDlhXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_SX300.jpg",
                streaming: "Tubi"
            },
            {
                title: "The Princess Bride",
                year: 1987,
                poster: "https://m.media-amazon.com/images/M/MV5BMGM4M2Q5N2MtNThkZS00NTc1LTk1NTItNWEyZjJjNDRmNDk5XkEyXkFqcGdeQXVyMjA0MDQ0Mjc@._V1_SX300.jpg",
                streaming: "Lionsgate+"
            },
            {
                title: "When Harry Met Sally...",
                year: 1989,
                poster: "https://m.media-amazon.com/images/M/MV5BMjE0ODEwNjM2NF5BMl5BanBnXkFtZTcwMjU2ODkyMQ@@._V1_SX300.jpg",
                streaming: "MGM+"
            },
            {
                title: "Misery",
                year: 1990,
                poster: "https://m.media-amazon.com/images/M/MV5BNzY0ODQ3MTMxN15BMl5BanBnXkFtZTgwMDkwNTg4NjE@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "A Few Good Men",
                year: 1992,
                poster: "https://m.media-amazon.com/images/M/MV5BMmRlZDQ1MmUtNWI2ZS00MTI1LTg3YWYtYjQ1YjI4ZWQxYWM1XkEyXkFqcGdeQXVyNTAyODkwOQ@@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "North",
                year: 1994,
                poster: "https://m.media-amazon.com/images/M/MV5BOTYyNTU4MDEtMDc4OS00MzI2LWE0MGItZGU1M2ZjMmY2ZDVhXkEyXkFqcGdeQXVyNjE5MjUyOTM@._V1_SX300.jpg",
                streaming: "Rent/Buy"
            },
            {
                title: "The American President",
                year: 1995,
                poster: "https://m.media-amazon.com/images/M/MV5BNDc0YjU0OWMtNTAzMC00MWZhLTgyYjMtMGE2ODhiMjQzODk5L2ltYWdlL2ltYWdlXkEyXkFqcGdeQXVyNTAyODkwOQ@@._V1_SX300.jpg",
                streaming: "Rent/Buy"
            },
            {
                title: "Ghosts of Mississippi",
                year: 1996,
                poster: "https://m.media-amazon.com/images/M/MV5BMTQ2ODA4ODMzMV5BMl5BanBnXkFtZTcwOTgxODMzMQ@@._V1_SX300.jpg",
                streaming: "Rent/Buy"
            },
            {
                title: "The Story of Us",
                year: 1999,
                poster: "https://m.media-amazon.com/images/M/MV5BMjA3MTQ1NjQxN15BMl5BanBnXkFtZTcwNDI0MzIyMQ@@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "Alex & Emma",
                year: 2003,
                poster: "https://m.media-amazon.com/images/M/MV5BMTIzMjQ4MDQ5MV5BMl5BanBnXkFtZTcwNjg5NjYyMQ@@._V1_SX300.jpg",
                streaming: "Sky Store"
            },
            {
                title: "Rumor Has It...",
                year: 2005,
                poster: "https://m.media-amazon.com/images/M/MV5BMjA5NzU3NjYzOV5BMl5BanBnXkFtZTcwMjc0ODEzMQ@@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "The Bucket List",
                year: 2007,
                poster: "https://m.media-amazon.com/images/M/MV5BMTM1MzMxNjQyOV5BMl5BanBnXkFtZTcwMjQzMzMzMQ@@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "Flipped",
                year: 2010,
                poster: "https://m.media-amazon.com/images/M/MV5BODc2MjhmZDgtNzlhOS00N2NhLWEyNDAtN2FlMTc3MTU5MjBhXkEyXkFqcGdeQXVyNjE5MjUyOTM@._V1_SX300.jpg",
                streaming: "Rent/Buy"
            },
            {
                title: "The Magic of Belle Isle",
                year: 2012,
                poster: "https://m.media-amazon.com/images/M/MV5BMTYzMTQzNjQzNF5BMl5BanBnXkFtZTcwMjk3NjYxOA@@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "And So It Goes",
                year: 2014,
                poster: "https://m.media-amazon.com/images/M/MV5BMTg5NDg1NjcyN15BMl5BanBnXkFtZTgwMTg5NDM0MTE@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "Being Charlie",
                year: 2015,
                poster: "https://m.media-amazon.com/images/M/MV5BMTc4MjEwNzE4Ml5BMl5BanBnXkFtZTgwNzQ3NjQ1ODE@._V1_SX300.jpg",
                streaming: "Prime Video"
            },
            {
                title: "LBJ",
                year: 2016,
                poster: "https://m.media-amazon.com/images/M/MV5BNTczNjkxMDc4OV5BMl5BanBnXkFtZTgwNDk3MjQyNDI@._V1_SX300.jpg",
                streaming: "Rent/Buy"
            },
            {
                title: "Shock and Awe",
                year: 2017,
                poster: "https://m.media-amazon.com/images/M/MV5BMjMxNjY4Njc3Ml5BMl5BanBnXkFtZTgwNTIxMzgyNTM@._V1_SX300.jpg",
                streaming: "Rakuten TV"
            },
            {
                title: "Albert Brooks: Defending My Life",
                year: 2023,
                poster: "https://m.media-amazon.com/images/M/MV5BOGNjMjkxN2QtOWVhOS00NTlhLTk4ZGEtYzg3NTBiOTc2YjU5XkEyXkFqcGdeQXVyMTM1NjM2ODg1._V1_SX300.jpg",
                streaming: "NOW TV"
            },
            {
                title: "Spinal Tap II",
                year: 2025,
                poster: "https://m.media-amazon.com/images/M/MV5BMTQ2MTIzMzg5Nl5BMl5BanBnXkFtZTgwOTc5NDI1MDE@._V1_SX300.jpg",
                streaming: "Theaters/VOD"
            }
        ];

        const wittyRemarks = [
            "Only available on VHS in a basement in Jersey.",
            "You might have to act this one out yourself.",
            "Ask your dad, he probably has the DVD.",
            "Streaming in an alternate timeline.",
            "Check the bargain bin at the gas station.",
            "Not even Rob watches this one anymore.",
            "Good luck finding a torrent.",
            "Maybe try reading the screenplay?",
            "It's a classic... in a 'hard to find' way."
        ];

        const quotes = [
            { threshold: 0, text: "I'll have what she's having." }, // Harry Met Sally
            { threshold: 2, text: "As you wish." }, // Princess Bride
            { threshold: 5, text: "Inconceivable!" }, // Princess Bride
            { threshold: 8, text: "You can't handle the truth!" }, // A Few Good Men
            { threshold: 12, text: "These go to eleven." }, // Spinal Tap
            { threshold: 15, text: "I'm your number one fan." }, // Misery
            { threshold: 18, text: "Have fun storming the castle!" }, // Princess Bride
            { threshold: 21, text: "You've got a friend in me... wait wrong Reiner." }, // Joke
            { threshold: 22, text: "And so it goes." } // Title/End
        ];

        const STORAGE_KEY = 'reiner_run_progress';
        let watched = new Set();

        function load() {
            try {
                const saved = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (Array.isArray(saved)) {
                    watched = new Set(saved);
                }
            } catch (e) {
                console.error("Failed to load progress", e);
            }
        }

        function save() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify([...watched]));
            updateStats();
        }

        function toggleWatch(title) {
            if (watched.has(title)) {
                watched.delete(title);
            } else {
                watched.add(title);
            }
            save();
        }

        function getQuote(count) {
            // Find the highest threshold less than or equal to count
            let best = quotes[0];
            for (let q of quotes) {
                if (count >= q.threshold) {
                    best = q;
                } else {
                    break;
                }
            }
            return best.text;
        }

        function updateStats() {
            const count = watched.size;
            const total = films.length;
            const pct = Math.round((count / total) * 100);

            document.getElementById('progressText').innerText = `${pct}%`;
            document.getElementById('progressBar').style.width = `${pct}%`;
            document.getElementById('watchedCount').innerText = `${count} watched`;
            document.getElementById('totalCount').innerText = `${total} total`;

            // Update Header Quote
            const headerQuote = document.querySelector('.text-[#556677].uppercase.font-semibold');
            if (headerQuote) {
                headerQuote.innerText = getQuote(count);
            }
        }

        function render() {
            const container = document.getElementById('movieList');
            const template = document.getElementById('movieRowTemplate');

            // Clear existing logic if re-rendering (not strictly needed here but good practice)
            container.innerHTML = '';

            films.forEach((film, index) => {
                const clone = template.content.cloneNode(true);

                // Populate Logic
                clone.querySelector('.movie-title').textContent = film.title;
                clone.querySelector('.movie-year').textContent = film.year;

                // Poster logic
                const img = clone.querySelector('.poster-img');
                const ph = clone.querySelector('.poster-placeholder');
                const phText = clone.querySelector('.poster-year');

                if (film.poster) {
                    img.src = film.poster;
                    img.classList.remove('hidden');
                    // Hide placeholder text but keep container bg as fallback? 
                    // Actually z-index or simple hiding works. 
                    // Let's just hide the placeholder text container.
                    // But wait, the img creates a layer. 
                } else {
                    phText.textContent = film.year;
                }

                // Streaming / Witty logic
                const streamEl = clone.querySelector('.streaming-info');
                const remarkEl = clone.querySelector('.witty-remark');

                if (film.streaming) {
                    streamEl.textContent = "On " + film.streaming;
                    streamEl.classList.remove('hidden');
                } else {
                    // Unique remark per movie based on hash or index to be consistent?
                    // Or just random? Random changes on reload, which is arguably fun or annoying.
                    // Let's use index-based consistent random.
                    const remark = wittyRemarks[index % wittyRemarks.length];
                    remarkEl.textContent = remark;
                    remarkEl.classList.remove('hidden');
                }

                // Checkbox
                const checkbox = clone.querySelector('.movie-check');
                checkbox.checked = watched.has(film.title);
                checkbox.addEventListener('change', () => toggleWatch(film.title));

                // Links
                const query = encodeURIComponent(film.title + " movie streaming UK");
                const link = `https://www.google.com/search?q=${query}`;
                clone.querySelector('.where-to-watch-link').href = link;

                container.appendChild(clone);
            });

            updateStats();
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            load();
            render();
        });

    </script>
</body>

</html>